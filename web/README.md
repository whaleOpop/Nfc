# NFC Medical Platform - Web Frontend

Полноценное веб-приложение для управления медицинскими данными через NFC.

## Реализованный функционал

### Страницы

#### 1. Публичные страницы (не требуют авторизации)
- **Главная страница** (`/`) - Приветственная страница с кнопками входа/регистрации
- **Вход** (`/login`) - Форма входа с валидацией
- **Регистрация** (`/register`) - Полная форма регистрации с ролями
- **Экстренный доступ** (`/emergency/:tagId`) - Публичный доступ к медданным по NFC/QR

#### 2. Защищенные страницы (требуют авторизации)
- **Дашборд** (`/dashboard`) - Главная панель пользователя со статистикой
- **Медицинский профиль** (`/profile`) - Управление медицинскими данными
- **Управление NFC** (`/nfc`) - Создание и управление NFC метками
- **Админ панель** (`/admin`) - Панель для администраторов и медработников

### Архитектура

#### API сервисы (api.js)
- Централизованный Axios клиент с базовым URL
- Автоматическая подстановка JWT токенов в заголовки
- Автоматическое обновление токенов при истечении (401)
- Разделение на модули: `authAPI`, `profileAPI`, `nfcAPI`

#### Аутентификация (AuthContext.jsx)
- React Context для глобального состояния аутентификации
- Автоматическая проверка авторизации при загрузке приложения
- Методы: `login()`, `register()`, `logout()`, `checkAuth()`
- Хранение токенов в localStorage

#### Защита роутов (ProtectedRoute.jsx)
- Компонент для защиты приватных страниц
- Автоматический редирект на `/login` если не авторизован
- Показ загрузки при проверке аутентификации

### Функции по страницам

#### Login (Login.jsx)
- Email и пароль валидация
- Переключатель видимости пароля
- Обработка ошибок с toast уведомлениями
- Редирект на дашборд после успешного входа

#### Register (Register.jsx)
- Поля: email, пароль, подтверждение пароля, ФИО, телефон, роль
- Проверка совпадения паролей
- Валидация email формата
- Выбор роли: Пациент / Медработник / Администратор

#### Dashboard (Dashboard.jsx)
- Статистика: количество NFC меток, активных доступов, заполненность профиля
- Быстрые действия: Мой профиль, Мои NFC метки, Админ панель (для админов)
- AppBar с навигацией и профилем пользователя

#### Profile (Profile.jsx)
Управление медицинскими данными:
- **Основная информация**: группа крови, рост, вес, экстренные заметки
- **Аллергии**: добавление/удаление с указанием степени тяжести
- **Хронические заболевания**: добавление с датой диагностирования
- **Препараты**: название, дозировка, частота приема
- **Экстренные контакты**: ФИО, отношение, телефон

#### NFCManagement (NFCManagement.jsx)
- **Вкладка "Мои метки"**:
  - Список всех NFC меток пользователя
  - Создание новой метки
  - Активация/деактивация метки
  - Показ QR-кода для метки
  - Скачивание QR-кода как изображения
  - Статистика обращений по метке

- **Вкладка "История доступа"**:
  - Таблица всех обращений к меткам
  - Показ даты, типа доступа (NFC/QR), IP адреса, статуса

#### AdminPanel (AdminPanel.jsx)
Доступна только для ролей ADMIN и MEDICAL_WORKER:
- **Статистика**: пользователи, NFC метки, обращения, активность за сегодня
- **История доступа**: полный лог всех обращений в системе с поиском
- **Пользователи**: функционал в разработке
- Автоматический редирект если нет прав доступа

#### EmergencyAccess (EmergencyAccess.jsx)
Публичная страница для экстренного доступа:
- **Отображение**:
  - ФИО пациента, возраст, пол
  - Группа крови (крупно, красным)
  - Рост и вес
  - Экстренные заметки (яркий Alert)
  - Аллергии с указанием степени опасности
  - Хронические заболевания
  - Текущие препараты с дозировкой
  - Экстренные контакты с телефонами
- Работает без авторизации
- Лог обращения записывается автоматически

## Технологии

- **React 18** - UI библиотека
- **React Router 6** - Роутинг
- **Material-UI 5** - UI компоненты
- **Axios** - HTTP клиент
- **React Query** - Управление серверным состоянием
- **React Hook Form + Yup** - Формы и валидация
- **Zustand** - Управление клиентским состоянием (настроено, но не используется пока)
- **React Toastify** - Уведомления
- **QRCode.react** - Генерация QR-кодов
- **Date-fns** - Работа с датами
- **Vite** - Сборщик

## Запуск

### Development
```bash
cd web
npm install
npm run dev
```
Приложение запустится на [http://localhost:3000](http://localhost:3000)

### Production Build
```bash
npm run build
```
Результат будет в папке `dist/`

### Preview Production Build
```bash
npm run preview
```

## Конфигурация

### Переменные окружения
Создайте `.env` файл из `.env.example`:

```env
VITE_API_URL=https://testapi.soldium.ru
VITE_APP_NAME=NFC Medical Platform
VITE_ENVIRONMENT=production
```

### Для локальной разработки с бэкендом
```env
VITE_API_URL=http://localhost:8000
VITE_ENVIRONMENT=development
```

## API Endpoints

Используются следующие эндпоинты бэкенда:

### Auth
- `POST /api/auth/register/` - Регистрация
- `POST /api/auth/login/` - Вход
- `POST /api/auth/logout/` - Выход
- `POST /api/auth/token/refresh/` - Обновление токена
- `GET /api/auth/me/` - Получение текущего пользователя

### Profile
- `GET /api/profiles/medical-profile/` - Получение профиля
- `PUT /api/profiles/medical-profile/` - Обновление профиля
- `GET /api/profiles/allergies/` - Список аллергий
- `POST /api/profiles/allergies/` - Добавить аллергию
- `DELETE /api/profiles/allergies/:id/` - Удалить аллергию
- `GET /api/profiles/chronic-diseases/` - Список заболеваний
- `POST /api/profiles/chronic-diseases/` - Добавить заболевание
- `DELETE /api/profiles/chronic-diseases/:id/` - Удалить заболевание
- `GET /api/profiles/medications/` - Список препаратов
- `POST /api/profiles/medications/` - Добавить препарат
- `DELETE /api/profiles/medications/:id/` - Удалить препарат
- `GET /api/profiles/emergency-contacts/` - Список контактов
- `POST /api/profiles/emergency-contacts/` - Добавить контакт
- `DELETE /api/profiles/emergency-contacts/:id/` - Удалить контакт

### NFC
- `GET /api/nfc/tags/` - Список NFC меток
- `POST /api/nfc/tags/` - Создать метку
- `PUT /api/nfc/tags/:id/` - Обновить метку
- `GET /api/nfc/access-logs/` - История доступа
- `GET /api/nfc/emergency/:tagId/` - Публичный доступ к медданным (без auth)

## Структура файлов

```
web/
├── src/
│   ├── components/
│   │   └── ProtectedRoute.jsx     # HOC для защиты роутов
│   ├── contexts/
│   │   └── AuthContext.jsx        # Контекст аутентификации
│   ├── pages/
│   │   ├── Login.jsx              # Страница входа
│   │   ├── Register.jsx           # Страница регистрации
│   │   ├── Dashboard.jsx          # Главная панель
│   │   ├── Profile.jsx            # Медицинский профиль
│   │   ├── NFCManagement.jsx      # Управление NFC
│   │   ├── AdminPanel.jsx         # Админ панель
│   │   └── EmergencyAccess.jsx    # Экстренный доступ
│   ├── services/
│   │   └── api.js                 # API клиент и сервисы
│   ├── App.jsx                    # Главный компонент с роутами
│   └── main.jsx                   # Точка входа
├── .env                           # Переменные окружения
├── .env.example                   # Пример конфигурации
├── package.json                   # Зависимости
├── vite.config.js                 # Конфигурация Vite
└── README.md                      # Эта документация
```

## Что нужно сделать на сервере

### 1. Обновить .env файл на сервере
```bash
# В c:\Users\User\Desktop\Nfc\web\.env
VITE_API_URL=https://testapi.soldium.ru
VITE_ENVIRONMENT=production
```

### 2. Пересобрать и задеплоить фронтенд
```bash
cd /root/nfc
git pull
docker-compose down web
docker-compose up -d --build web
```

### 3. Убедиться что Nginx правильно настроен
Файл `docker/nginx/conf.d/nfc.conf` должен быть подключен к `soldium-nginx`:
```bash
# Проверить что конфиг скопирован
ls -la /путь/к/soldium-nginx/conf.d/nfc.conf

# Перезапустить nginx
docker restart soldium-nginx
```

## TODO / Будущие улучшения

- [ ] Страница редактирования профиля пользователя (не медицинского)
- [ ] Поиск и просмотр пациентов для медработников
- [ ] Загрузка аватара пользователя
- [ ] Графики и аналитика в админ панели
- [ ] Экспорт медицинских данных в PDF
- [ ] Мультиязычность (сейчас только русский)
- [ ] Dark mode
- [ ] Push уведомления при доступе к NFC метке
- [ ] История изменений медицинского профиля
- [ ] Возможность временного доступа к профилю для конкретных медработников

## Тестирование

Для тестирования используйте следующие тестовые данные:

### Регистрация нового пользователя
1. Перейти на `/register`
2. Заполнить форму:
   - Email: test@example.com
   - Пароль: testpassword123
   - Имя, Фамилия, Телефон
   - Роль: Пациент
3. После регистрации автоматически произойдет вход

### Заполнение медицинского профиля
1. Перейти в "Мой профиль"
2. Заполнить основную информацию
3. Добавить аллергии, заболевания, препараты
4. Добавить экстренные контакты

### Создание NFC метки
1. Перейти в "Мои NFC метки"
2. Создать новую метку
3. Скачать QR-код
4. Протестировать доступ через `/emergency/:tagId`

## Поддержка

При возникновении проблем проверьте:
1. Правильность VITE_API_URL в .env
2. Доступность бэкенда API
3. Наличие CORS разрешений на бэкенде для домена фронтенда
4. Логи браузера (F12 > Console)
5. Логи Docker контейнера: `docker logs nfc_web`
