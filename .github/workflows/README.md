# GitHub Actions Workflows

ะะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัะต CI/CD pipelines ะดะปั NFC Medical Platform.

## ๐ฑ Mobile Builds

### Android Build
**ะคะฐะนะป**: `android-build.yml`
**ะขัะธะณะณะตั**: Push ะฒ `main` branch
**ะััะตัะฐะบัั**:
- APK: `app-release.apk` (ะดะปั ัััะฐะฝะพะฒะบะธ ะฝะฐ ััััะพะนััะฒะพ)
- AAB: `app-release.aab` (ะดะปั Google Play Store)

**ะัะพัะตัั**:
1. โฌ๏ธ ะะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะปะธัะธะฒะฐะตั build number ะฒ `pubspec.yaml`
2. ๐๏ธ ะกะพะฑะธัะฐะตั APK ะธ AAB ัะฐะนะปั
3. ๐ฆ ะะฐะณััะถะฐะตั ะฒ GitHub Artifacts (ััะฐะฝะธััั 90 ะดะฝะตะน)
4. ๐ ะกะพะทะดะฐะตั GitHub Release ั ัะตะณะพะผ `android-vX.X.X+BUILD`

### iOS Build
**ะคะฐะนะป**: `ios-build.yml`
**ะขัะธะณะณะตั**: Push ะฒ `main` branch
**ะััะตัะฐะบัั**:
- IPA: `FlutterIpaExport.ipa` (ะฑะตะท code signing)

**ะัะพัะตัั**:
1. โฌ๏ธ ะะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะปะธัะธะฒะฐะตั build number ะฒ `pubspec.yaml`
2. ๐๏ธ ะกะพะฑะธัะฐะตั IPA ัะฐะนะป
3. ๐ฆ ะะฐะณััะถะฐะตั ะฒ GitHub Artifacts
4. ๐ ะกะพะทะดะฐะตั GitHub Release ั ัะตะณะพะผ `ios-vX.X.X+BUILD`

โ๏ธ **ะัะธะผะตัะฐะฝะธะต**: IPA ัะพะฑะธัะฐะตััั ะฑะตะท code signing. ะะปั ัะฐัะฟัะพัััะฐะฝะตะฝะธั ัะตัะตะท App Store ััะตะฑัะตััั ะดะพะฟะพะปะฝะธัะตะปัะฝะฐั ะฝะฐัััะพะนะบะฐ ั Apple Developer ัะตััะธัะธะบะฐัะฐะผะธ.

---

## ๐ฅ๏ธ Backend Deployment

**ะคะฐะนะป**: `backend-deploy.yml`
**ะขัะธะณะณะตั**: Push ะฒ `main` (ัะพะปัะบะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธัั ะฒ `backend/**`)
**ะัะพัะตัั**:

1. ๐ ะะพะดะบะปััะตะฝะธะต ะบ ัะตัะฒะตัั ัะตัะตะท SSH
2. ๐ฅ Git pull ะฟะพัะปะตะดะฝะธั ะธะทะผะตะฝะตะฝะธะน
3. ๐ณ ะะตัะตัะฑะพัะบะฐ ะธ ะฟะตัะตะทะฐะฟััะบ Docker ะบะพะฝัะตะนะฝะตัะพะฒ
4. ๐ ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน ะะ
5. ๐ฆ ะกะฑะพั ััะฐัะธัะตัะบะธั ัะฐะนะปะพะฒ
6. ๐ฅ Health check API endpoint

**ะขัะตะฑะพะฒะฐะฝะธั ะฝะฐ ัะตัะฒะตัะต**:
- Docker ะธ Docker Compose
- SSH ะดะพัััะฟ
- Git repository ะบะปะพะฝะธัะพะฒะฐะฝ ะฒ `$SERVER_PATH`
- `.env` ัะฐะนะป ั ะฝะฐัััะพะนะบะฐะผะธ

---

## ๐ Frontend Deployment

### GitHub Pages (ะะตะบะพะผะตะฝะดัะตััั)
**ะคะฐะนะป**: `pages-deploy.yml`
**ะขัะธะณะณะตั**: Push ะฒ `main` (ัะพะปัะบะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธัั ะฒ `web/**`)
**URL**: `https://<username>.github.io/<repo-name>/`

**ะัะพัะตัั**:
1. ๐ฆ ะฃััะฐะฝะพะฒะบะฐ npm ะทะฐะฒะธัะธะผะพััะตะน
2. ๐๏ธ ะกะฑะพัะบะฐ React ะฟัะธะปะพะถะตะฝะธั (Vite) ั ะฟัะฐะฒะธะปัะฝัะผ base path
3. ๐ค ะะฐะณััะทะบะฐ ะฒ GitHub Pages
4. ๐ ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะฑะปะธะบะฐัะธั
5. โ ะัะฒะพะด deployment URL

**ะัะตะธะผััะตััะฒะฐ**:
- โ ะะตัะฟะปะฐัะฝัะน ัะพััะธะฝะณ ะพั GitHub
- โ HTTPS ะธะท ะบะพัะพะฑะบะธ
- โ CDN ะธ ะฒััะพะบะฐั ัะบะพัะพััั
- โ ะะต ััะตะฑัะตั ัะพะฑััะฒะตะฝะฝะพะณะพ ัะตัะฒะตัะฐ
- โ ะะฒัะพะผะฐัะธัะตัะบะธะต ะดะตะฟะปะพะธ ะฟัะธ push

**ะะฐัััะพะนะบะฐ**:
1. ะะตัะตะนะดะธัะต ะฒ **Settings** โ **Pages**
2. Source: **GitHub Actions**
3. Workflow ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะตะฟะปะพะธั ะฟะพัะปะต push ะฒ `main`

**URL ัะตะฟะพะทะธัะพัะธั**:
- ะัะปะธ ัะตะฟะพะทะธัะพัะธะน `username.github.io`: `https://username.github.io/`
- ะะฝะฐัะต: `https://username.github.io/repo-name/`

โ๏ธ **ะะฐะถะฝะพ**: ะ secrets ะดะพะฑะฐะฒััะต `VITE_API_URL` ั ะฐะดัะตัะพะผ ะฒะฐัะตะณะพ backend API

---

### Self-hosted Server
**ะคะฐะนะป**: `web-deploy.yml`
**ะขัะธะณะณะตั**: Push ะฒ `main` (ัะพะปัะบะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธัั ะฒ `web/**`)
**ะัะพัะตัั**:

1. ๐ฆ ะฃััะฐะฝะพะฒะบะฐ npm ะทะฐะฒะธัะธะผะพััะตะน
2. ๐๏ธ ะกะฑะพัะบะฐ React ะฟัะธะปะพะถะตะฝะธั (Vite)
3. ๐ค ะะฐะณััะทะบะฐ build ะฝะฐ ัะตัะฒะตั ัะตัะตะท SCP
4. ๐พ ะกะพะทะดะฐะฝะธะต backup ะฟัะตะดัะดััะตะน ะฒะตััะธะธ
5. ๐ ะะฐัะฟะฐะบะพะฒะบะฐ ะฝะพะฒะพะณะพ build
6. ๐ Reload Nginx
7. ๐ฅ Health check frontend URL

**ะขัะตะฑะพะฒะฐะฝะธั ะฝะฐ ัะตัะฒะตัะต**:
- Nginx ัััะฐะฝะพะฒะปะตะฝ ะธ ะฝะฐัััะพะตะฝ
- SSH ะดะพัััะฟ
- ะะธัะตะบัะพัะธั `$WEB_PATH` ัััะตััะฒัะตั

---

## ๐ ะะฐัััะพะนะบะฐ Secrets

ะัะต ะฝะตะพะฑัะพะดะธะผัะต GitHub Secrets ะพะฟะธัะฐะฝั ะฒ [SECRETS_SETUP.md](../SECRETS_SETUP.md)

### ะััััะฐั ะฟัะพะฒะตัะบะฐ
```bash
# Backend secrets (ะดะปั self-hosted)
โ SSH_PRIVATE_KEY
โ SERVER_HOST
โ SERVER_USER
โ SERVER_PATH
โ BACKEND_URL

# Frontend secrets (ะดะปั self-hosted)
โ WEB_PATH
โ WEB_URL

# Frontend secrets (ะดะปั GitHub Pages)
โ VITE_API_URL (URL ะฒะฐัะตะณะพ backend API)
โ VITE_APP_NAME (ะพะฟัะธะพะฝะฐะปัะฝะพ)
```

---

## ๐ฏ Workflow Triggers

| Workflow | Trigger | ะฃัะปะพะฒะธะต |
|----------|---------|---------|
| Android Build | Push to main | ะัะตะณะดะฐ |
| iOS Build | Push to main | ะัะตะณะดะฐ |
| Backend Deploy | Push to main | ะะทะผะตะฝะตะฝะธั ะฒ `backend/**` |
| GitHub Pages Deploy | Push to main | ะะทะผะตะฝะตะฝะธั ะฒ `web/**` |
| Self-hosted Web Deploy | Push to main | ะะทะผะตะฝะตะฝะธั ะฒ `web/**` |
| Full Deploy | Manual | ะงะตัะตะท GitHub UI |

---

## ๐ Workflow Status

ะัะพะฒะตัะธัั ััะฐััั workflows:

1. ะัะบัะพะนัะต **Actions** tab ะฒ GitHub ัะตะฟะพะทะธัะพัะธะธ
2. ะัะฑะตัะธัะต ะฝัะถะฝัะน workflow ัะปะตะฒะฐ
3. ะะพัะผะพััะธัะต ะฟะพัะปะตะดะฝะธะต runs ะธ ะธั ััะฐััั

### ะฆะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั:
- ๐ข **ะะตะปะตะฝัะน**: ะฃัะฟะตัะฝะพ ะฒัะฟะพะปะฝะตะฝ
- ๐ก **ะะตะปััะน**: ะ ะฟัะพัะตััะต ะฒัะฟะพะปะฝะตะฝะธั
- ๐ด **ะัะฐัะฝัะน**: ะัะธะฑะบะฐ ะฒัะฟะพะปะฝะตะฝะธั
- โช **ะกะตััะน**: ะะถะธะดะฐะฝะธะต ะทะฐะฟััะบะฐ

---

## ๐ง ะะพะบะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต

### Android
```bash
cd mobile
flutter build apk --release
# APK: build/app/outputs/flutter-apk/app-release.apk
```

### iOS
```bash
cd mobile
flutter build ios --no-codesign
# Requires macOS
```

### Backend
```bash
cd backend
docker-compose up --build
```

### Frontend
```bash
cd web
npm install
npm run build
# Output: dist/
```

---

## ๐ Troubleshooting

### Android build fails
- **ะัะพะฑะปะตะผะฐ**: Java version mismatch
- **ะะตัะตะฝะธะต**: Workflow ะธัะฟะพะปัะทัะตั Java 17 (Zulu)

### iOS build fails
- **ะัะพะฑะปะตะผะฐ**: CocoaPods dependencies
- **ะะตัะตะฝะธะต**: Workflow ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตั CocoaPods

### Backend deployment fails
- **ะัะพะฑะปะตะผะฐ**: SSH connection timeout
- **ะะตัะตะฝะธะต**: ะัะพะฒะตัััะต `SSH_PRIVATE_KEY` ะธ `SERVER_HOST`

### Frontend deployment fails
- **ะัะพะฑะปะตะผะฐ**: Permission denied
- **ะะตัะตะฝะธะต**: ะฃะฑะตะดะธัะตัั ััะพ `$WEB_PATH` ะฟัะธะฝะฐะดะปะตะถะธั `www-data`

---

## ๐ ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต

### ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฒะตะปะธัะตะฝะธะต build number:

Mobile builds (Android/iOS):
- ะะตััะธั: `X.Y.Z` (manual ะฒ pubspec.yaml)
- Build: `N` (ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะปะธัะธะฒะฐะตััั ะฟัะธ ะบะฐะถะดะพะผ build)
- ะคะพัะผะฐั: `X.Y.Z+N`
- Commit: `โฌ๏ธ Bump build number to N`

Backend/Frontend:
- ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ัะตัะตะท Git tags
- ะัะฟะพะปัะทัะนัะต semantic versioning: `v1.0.0`, `v1.1.0`, etc.

---

## ๐ Deployment Flow

```
โโโโโโโโโโโโโโโโโโโ
โ   Git Push      โ
โ   to main       โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
    โโโโโโผโโโโโ
    โ Changed?โ
    โโโโโโฌโโโโโ
         โ
    โโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                                  โ
โโโโโผโโโโโ  โโโโโโโโผโโโโ  โโโโโโโโผโโโ
โ Mobile โ  โ Backend  โ  โFrontend โ
โ Builds โ  โ  Deploy  โ  โ Deploy  โ
โโโโโฌโโโโโ  โโโโโโโโฌโโโโ  โโโโโโโฌโโโโ
    โ              โ             โ
    โผ              โผ             โผ
โโโโโโโโโโ   โโโโโโโโโโโโ  โโโโโโโโโโ
โRelease โ   โ  Server  โ  โ Server โ
โon GH   โ   โ  Docker  โ  โ Nginx  โ
โโโโโโโโโโ   โโโโโโโโโโโโ  โโโโโโโโโโ
```

---

## ๐ Best Practices

1. **Commit Messages**: ะัะฟะพะปัะทัะนัะต conventional commits
   - `feat:` ะดะปั ะฝะพะฒัั ััะฝะบัะธะน
   - `fix:` ะดะปั ะธัะฟัะฐะฒะปะตะฝะธะน
   - `docs:` ะดะปั ะดะพะบัะผะตะฝัะฐัะธะธ
   - `ci:` ะดะปั CI/CD ะธะทะผะตะฝะตะฝะธะน

2. **Branch Strategy**:
   - `main` - production-ready ะบะพะด
   - `develop` - ัะฐะทัะฐะฑะพัะบะฐ
   - `feature/*` - ะฝะพะฒัะต ัะธัะธ

3. **Secrets**: ะะตะณัะปััะฝะพ ัะพัะธััะนัะต SSH ะบะปััะธ

4. **Monitoring**: ะะฐัััะพะนัะต ัะฒะตะดะพะผะปะตะฝะธั ะพ failed workflows

5. **Backups**: Backend deployment ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตั backups

---

## ๐ Support

ะัะธ ะฟัะพะฑะปะตะผะฐั ั CI/CD:

1. ะัะพะฒะตัััะต ะปะพะณะธ ะฒ **Actions** tab
2. ะฃะฑะตะดะธัะตัั ััะพ ะฒัะต Secrets ะฝะฐัััะพะตะฝั
3. ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั ัะตัะฒะตัะฐ
4. ะัะพะฒะตัััะต ะฟัะฐะฒะฐ ะดะพัััะฟะฐ ะฝะฐ ัะตัะฒะตัะต

---

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- [GitHub Actions Docs](https://docs.github.com/en/actions)
- [Flutter Build Docs](https://docs.flutter.dev/deployment)
- [Docker Compose Docs](https://docs.docker.com/compose/)
- [Nginx Docs](https://nginx.org/en/docs/)
